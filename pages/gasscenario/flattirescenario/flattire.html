<!DOCTYPE html>
<html lang="en">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="/styles.css">
    <head>
        <meta charset="UTF-8">
        <title>Car Simulation</title>
        <link rel="stylesheet" href="style.css">

<style>
    #tire-simulation {
        position: relative;
        justify-content: start;
        align-items: center;
        left: 100px;
        top: 13px;
    }

    #tire {
        position: relative;
        top: 50px;
        height: 450px;
        width: 670px;
    }

    #stand {
        position: absolute;
        top: 130px;
        left: 530px;
        width: 650px;
        height: 500px;
        cursor: grab;
        user-select: none;
    }

    #stand.dragging {
      cursor: grabbing;
    }
    
    #lug-nut-zone {
      left: 25px;  /*193 here before*/
      top: 180px;   /*328 here before*/
      width: 100px;   /* tweak until it fits */
      height: 100px;  /* tweak until it fits */
      border: 3px solid red;  
      border-radius: 50%;        /* circle shape */
      pointer-events: none;  
      position: absolute;
    }

    #instruction-container {
      position: absolute;
      border: 4px solid orange;
      border-radius: 20px;
      margin-right: auto;
      left: 800px;
      bottom: 270px;
      height: 150px;
      width: 600px;
      font-size: 20px;
      padding-left: 20px;
      padding-top: 6px;
      padding-bottom: 40px;
    }

    #continueBtn {
    position: absolute;
    bottom: -130px;
    left: 10px; /* optional: put it somewhere visible */
}

</style>

</head>

<body>
    <div class="container"> 
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom"> 
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none"> 
                <span class="fs-2"></span> 
                <img src="/assets/Vroomly.png" class="car-icon" height="100">
            </a> 
        </header> 
    </div>
  
    <h1 style="font-weight: bold; margin-left: 530px;">Replace a Flat Tire</h1>

  <div id="instruction-container">
    <h3 style="margin-left: 10px;">Step 1</h3>
    <ol>
      <li>Face the tire that is currently flat.</li>
      <li>Find the cars stand, typically stored in the trunk. Place the stand below the car and crank the level to secure the stand.</li>
    </ol>
  </div>

  <div id="tire-simulation">
    <img src="/assets/flat-tire2.jpeg" id="tire" draggable="false">
    <div id="lug-nut-zone"></div>
    <img src="/assets/jackstand.png" id="stand">
    <button type="button" id="continueBtn" class="btn btn-warning btn-lg px-4 invisible" disabled>
        Continue
    </button> 

  </div>

    <script src="script.js"></script>
    <script>
    const stand = document.getElementById("stand");
    const continueBtn = document.getElementById("continueBtn");
    const fuelFilterZone = document.getElementById("lug-nut-zone");
    
    let isDragging = false;
    let offsetX = 0;
    let offsetY = 0;
    let alertShown = false;
    
    stand.addEventListener("mousedown", (e) => {
      isDragging = true;
      const rect = stand.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
      stand.style.cursor = "grabbing";
    });
    
    document.addEventListener("mousemove", (e) => {
      if (isDragging) {
        stand.style.left = `${e.clientX - offsetX}px`;
        stand.style.top = `${e.clientY - offsetY}px`;
      }
    });
    
    document.addEventListener("mouseup", (e) => {
      if (e.target === continueBtn) return;
      isDragging = false;
      stand.style.cursor = "grab";
    
      // Check if hand overlaps fuel filter zone
      const standRect = stand.getBoundingClientRect();
      const zoneRect = fuelFilterZone.getBoundingClientRect();
    
      if (
        standRect.left < zoneRect.right &&
        standRect.right > zoneRect.left &&
        standRect.top < zoneRect.bottom &&
        standRect.bottom > zoneRect.top
      ) {
    
        fuelFilterZone.style.border = "3px solid red";
    
         // Correct placement -> unlock continue button
        continueBtn.disabled = false;
        continueBtn.classList.remove("invisible");  
    
        if (!alertShown) {
          alert("You've successfully placed the stand!");
          alertShown = true;
        }
      }
      else {
        fuelFilterZone.style.border = "3px solid transparent";
      }
    });
    
    stand.addEventListener("dragstart", (e) => e.preventDefault());
    continueBtn.addEventListener("click", () => {
        window.location.href = "/pages/gasscenario/flattirescenario/flattire2.html";
    });
    
      </script>

</body>
</html>